# Криминальный Блеф - Telegram Mini App

## Миграция с Alpine.js на Vanilla JavaScript

Данный проект был успешно мигрирован с Alpine.js на чистый Vanilla JavaScript без сторонних зависимостей. Ниже описаны основные шаги миграции и принципы новой архитектуры.

### Причины миграции

1. **Конфликт с Telegram WebApp SDK**: Alpine.js создавал конфликты с API Telegram WebApp, вызывая нестабильную работу приложения.
2. **Проблемы с тестированием**: Тесты с Alpine.js часто были нестабильными из-за асинхронной инициализации компонентов.
3. **Размер бандла**: Уменьшение размера бандла за счет отказа от внешней библиотеки.
4. **Большая контролируемость**: Полный контроль над всеми аспектами приложения.

### Архитектура после миграции

1. **State Machine**: Внедрено центральное хранилище состояния (GameState) с управлением переходами между экранами.
2. **Компонентный подход**: Каждый модуль имеет свою зону ответственности.
3. **Автоматическое обновление UI**: При изменении данных интерфейс обновляется автоматически.
4. **Типизированные данные**: Четкая структура данных приложения.

### Структура проекта

```
public/
  ├── index.html       # Основной HTML-файл приложения
  ├── app.js           # Основной JavaScript с логикой приложения
  ├── game-state.js    # State Machine для управления состоянием
  └── styles.css       # Стили приложения
```

### Ключевые изменения

1. **Замена Alpine директив**:
   - Вместо `x-data` и `x-init` - обычный JavaScript и обработчики событий
   - Вместо `x-show` - CSS-классы `active` и управление стилями через JS
   - Вместо `x-text` - обновление textContent через DOM API
   - Вместо `@click` - обработчики событий через addEventListener

2. **State Machine для управления состоянием**:
   - Централизованное хранение данных в объекте `GameState`
   - Методы для управления переходами между экранами
   - Автоматическое обновление UI при изменении данных

3. **DOM манипуляции**:
   - Использование нативных методов DOM API
   - Динамическое создание элементов для ответов
   - Обновление содержимого DOM-элементов при изменении данных

### Тестирование

Для тестирования приложения можно использовать:

1. **Автоматический запуск игры**: Добавьте параметр `autostart=true` в URL
2. **Тестовый режим**: Добавьте параметр `test=true` в URL для работы без Telegram WebApp API
3. **Генерация тестовых данных**: Используйте `window.CriminalBluffTestInterface.loadTestStories()`

### Глобальный тестовый интерфейс

```javascript
window.CriminalBluffTestInterface = {
    // Основные функции игры
    startGame, selectAnswer, nextQuestion, goToMain, restartGame,
    
    // Получение состояния
    getState: () => ({ ... }),
    
    // Имитация действий пользователя
    simulateButtonClick, selectAnswerByIndex,
    
    // Тестовые данные
    loadTestStories
};
```

## Как запустить

1. Клонируйте репозиторий
2. Запустите `npm install`
3. Запустите `npm run dev`
4. Откройте `http://localhost:3000`

## Демо режим

Для демонстрации работы приложения без подключения к Telegram:
`http://localhost:3000?test=true&autostart=true`

## О проекте

"Криминальный Блеф" - это образовательно-развлекательная игра, в которой игроки тестируют свои навыки логического мышления и знания в области криминалистики. Проект разработан как Telegram Mini App, что делает его доступным для миллионов пользователей Telegram.

## Технологии

- **Frontend**: HTML, CSS, Vanilla JavaScript с паттерном State Machine
- **Backend**: Node.js, Express, MongoDB
- **Аутентификация**: JWT, Telegram WebApp API
- **Развертывание**: Railway

## Начало работы

### Предварительные требования

- Node.js (версия 16+)
- MongoDB (локально или в облаке)
- Telegram Bot Token

### Установка и запуск

1. Клонировать репозиторий:
   ```
   git clone https://github.com/your-username/criminal-bluff.git
   cd criminal-bluff
   ```

2. Установить зависимости:
   ```
   npm install
   ```

3. Создать файл `.env` на основе `.env.example` и заполнить необходимые значения.

4. Запустить сервер в режиме разработки:
   ```
   npm run dev
   ```

5. Для сборки и запуска в производственном режиме:
   ```
   npm start
   ```

## Структура проекта

```
/
├── public/                  # Статические файлы (frontend)
│   ├── index.html           # Входная точка приложения
│   ├── app.js               # JavaScript код приложения
│   ├── styles.css           # Стили
│   └── assets/              # Изображения, иконки и т.д.
├── src/                     # Исходный код сервера
│   ├── index.js             # Входная точка Express
│   ├── routes/              # Маршруты API
│   │   ├── auth.js          # Аутентификация
│   │   ├── game.js          # Игровая логика
│   │   └── ...
│   ├── models/              # Модели данных
│   ├── middleware/          # Middleware
│   └── utils/               # Утилиты
├── package.json             # Зависимости и скрипты
└── .env                     # Переменные окружения
```

## Основные функции

- Аутентификация через Telegram WebApp
- Игровой процесс с разнообразными криминальными историями
- Система подсчета очков с бонусами за скорость и сложность
- Личный профиль с игровой статистикой
- Таблицы лидеров

## Дорожная карта

### Фаза 1: MVP (Минимально жизнеспособный продукт)
- [x] Базовая авторизация через Telegram
- [x] Простой игровой процесс
- [x] Сохранение результатов

### Фаза 2: Расширение функциональности
- [ ] Профиль пользователя
- [ ] Рейтинговая система
- [ ] Улучшения UI/UX

### Фаза 3: Оптимизация и дополнительная функциональность
- [ ] Система достижений
- [ ] Базовый оффлайн-режим
- [ ] Оптимизации производительности

## Лицензия

[MIT](LICENSE)

## Контакты

Для вопросов и предложений по проекту свяжитесь с нами через [issues](https://github.com/your-username/criminal-bluff/issues). 