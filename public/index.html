<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Криминальный Блеф</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#0A0A0A">
    <meta name="description" content="Интерактивная игра-викторина с криминальными историями">

    <!-- Подключение Telegram WebApp API ПЕРВЫМ с защитой SRI -->
    <script src="https://telegram.org/js/telegram-web-app.js"
        integrity="sha384-E7bZJoZ9+8DJxhEo4jfK8t8XhCJaNu7xG5QbR4Zt8KYdZ9Q8rHCjW9GjS0JxB6V3"
        crossorigin="anonymous"></script>

    <style>
        :root {
            /* Современная цветовая палитра */
            --crime-scene: linear-gradient(135deg, #0A0A0A 0%, #1A1A1A 100%);
            --blood-red: #DC143C;
            --neon-red: #FF073A;
            --crimson: #C41E3A;
            --bone: #F5F5DC;
            --shadow: #000000;
            --electric-blue: #00BFFF;

            /* Градиенты */
            --blood-gradient: linear-gradient(135deg, #DC143C, #FF073A, #C41E3A);
            --card-gradient: linear-gradient(135deg, rgba(26, 26, 26, 0.95) 0%, rgba(20, 20, 20, 0.98) 100%);
            --accent-gradient: linear-gradient(135deg, #DC143C, #FF073A);

            /* Тени */
            --shadow-deep: 0 20px 40px rgba(0, 0, 0, 0.8), 0 0 30px rgba(220, 20, 60, 0.1);
            --shadow-glow: 0 0 20px rgba(220, 20, 60, 0.3);
            --shadow-text: 0 0 10px rgba(220, 20, 60, 0.5);

            /* Эффекты */
            --blur-heavy: blur(20px);
            --blur-light: blur(10px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--crime-scene);
            color: var(--bone);
            line-height: 1.4;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        /* Анимированный фоновый эффект */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(220, 20, 60, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 7, 58, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(196, 30, 58, 0.05) 0%, transparent 50%);
            animation: bloodFlow 25s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes bloodFlow {

            0%,
            100% {
                opacity: 0.4;
                transform: scale(1) rotate(0deg);
            }

            33% {
                opacity: 0.6;
                transform: scale(1.2) rotate(120deg);
            }

            66% {
                opacity: 0.5;
                transform: scale(0.8) rotate(240deg);
            }
        }

        /* Мрачные частицы */
        .crime-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--neon-red);
            border-radius: 50%;
            opacity: 0.7;
            animation: floatParticle 20s linear infinite;
        }

        @keyframes floatParticle {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.7;
            }

            90% {
                opacity: 0.7;
            }

            100% {
                transform: translateY(-10vh) translateX(150px) rotate(360deg);
                opacity: 0;
            }
        }

        .main-container {
            min-height: 100vh;
            position: relative;
            z-index: 10;
            max-width: 500px;
            margin: 0 auto;
            padding: 16px;
        }

        /* Заголовок отдела */
        .department-badge {
            text-align: center;
            margin-bottom: 24px;
            position: relative;
        }

        .badge-container {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: rgba(26, 26, 26, 0.9);
            border: 2px solid var(--blood-red);
            border-radius: 16px;
            padding: 12px 20px;
            backdrop-filter: var(--blur-light);
            box-shadow: var(--shadow-deep);
            position: relative;
            overflow: hidden;
        }

        .badge-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(220, 20, 60, 0.1), transparent);
            animation: badgeScan 3s ease-in-out infinite;
        }

        @keyframes badgeScan {
            0% {
                left: -100%;
            }

            50% {
                left: 100%;
            }

            100% {
                left: -100%;
            }
        }

        .badge-icon {
            width: 24px;
            height: 24px;
            color: var(--neon-red);
            filter: drop-shadow(0 0 8px var(--neon-red));
        }

        .badge-text {
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: var(--crimson);
            text-transform: uppercase;
        }

        /* Главный заголовок */
        .main-title {
            text-align: center;
            margin-bottom: 32px;
        }

        .title {
            font-size: 2.8rem;
            font-weight: 700;
            letter-spacing: 3px;
            background: var(--blood-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: var(--shadow-text);
            margin-bottom: 12px;
            animation: glitchText 6s ease-in-out infinite;
            line-height: 1.1;
        }

        .subtitle {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--bone);
            opacity: 0.9;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        @keyframes glitchText {

            0%,
            96%,
            100% {
                transform: translate(0);
            }

            1%,
            3% {
                transform: translate(-2px, 1px);
                text-shadow: 2px 0 var(--neon-red);
            }

            2% {
                transform: translate(2px, -1px);
                text-shadow: -2px 0 var(--electric-blue);
            }
        }

        /* Информационные карточки */
        .info-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 32px;
        }

        .info-card {
            background: var(--card-gradient);
            border: 2px solid var(--blood-red);
            border-radius: 20px;
            padding: 24px;
            position: relative;
            overflow: hidden;
            backdrop-filter: var(--blur-light);
            box-shadow: var(--shadow-deep);
            transition: all 0.4s ease;
        }

        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent-gradient);
            animation: scanLine 4s linear infinite;
        }

        @keyframes scanLine {
            0% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.3;
            }
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-deep), var(--shadow-glow);
            border-color: var(--neon-red);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .card-icon {
            width: 32px;
            height: 32px;
            color: var(--neon-red);
            filter: drop-shadow(0 0 8px var(--neon-red));
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--bone);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .card-label {
            font-size: 0.75rem;
            color: var(--crimson);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .card-description {
            font-size: 0.95rem;
            line-height: 1.6;
            color: var(--bone);
            opacity: 0.9;
        }

        /* Статистики */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--blood-red);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            position: relative;
            backdrop-filter: var(--blur-light);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--neon-red);
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.2);
            transform: scale(1.02);
        }

        .stat-icon {
            width: 28px;
            height: 28px;
            color: var(--neon-red);
            margin-bottom: 8px;
            filter: drop-shadow(0 0 6px var(--neon-red));
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--neon-red);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--bone);
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Главная кнопка */
        .main-action {
            margin-bottom: 24px;
        }

        .start-button {
            width: 100%;
            background: var(--accent-gradient);
            border: none;
            border-radius: 20px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--bone);
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-deep);
            transition: all 0.3s ease;
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .start-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-deep), var(--shadow-glow);
        }

        .start-button:hover::before {
            left: 100%;
        }

        .start-button:active {
            transform: translateY(-1px);
        }

        /* Навигация */
        .navigation {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .nav-button {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid var(--blood-red);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            color: var(--bone);
            text-decoration: none;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            backdrop-filter: var(--blur-light);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--accent-gradient);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-button:hover {
            border-color: var(--neon-red);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(220, 20, 60, 0.3);
        }

        .nav-button:hover::before {
            opacity: 0.1;
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 8px;
            color: var(--neon-red);
            position: relative;
            z-index: 1;
        }

        .nav-text {
            position: relative;
            z-index: 1;
        }

        /* Подвал */
        .footer {
            text-align: center;
            padding: 20px 0;
            border-top: 1px solid rgba(220, 20, 60, 0.2);
        }

        .case-file {
            font-size: 0.8rem;
            color: var(--bone);
            opacity: 0.6;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* Анимация входа */
        @keyframes criminalEntry {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .main-container>* {
            animation: criminalEntry 0.6s ease-out forwards;
        }

        .main-container>*:nth-child(1) {
            animation-delay: 0.1s;
        }

        .main-container>*:nth-child(2) {
            animation-delay: 0.2s;
        }

        .main-container>*:nth-child(3) {
            animation-delay: 0.3s;
        }

        .main-container>*:nth-child(4) {
            animation-delay: 0.4s;
        }

        .main-container>*:nth-child(5) {
            animation-delay: 0.5s;
        }

        .main-container>*:nth-child(6) {
            animation-delay: 0.6s;
        }

        /* Отзывчивость */
        @media (max-width: 400px) {
            .title {
                font-size: 2.4rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .main-container {
                padding: 12px;
            }
        }

        /* Loader */
        .loading-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background: var(--crime-scene);
            z-index: 9999;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(220, 20, 60, 0.2);
            border-top-color: var(--neon-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.3);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            color: var(--bone);
            letter-spacing: 1px;
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <!-- Частицы -->
    <div class="crime-particles" id="particles"></div>

    <!-- Loader -->
    <div class="loading-container" id="loader">
        <div class="loader"></div>
        <div class="loading-text">ЗАГРУЗКА ДЕЛА...</div>
    </div>

    <!-- Главный контейнер -->
    <div class="main-container" id="mainContainer" style="opacity: 0;">

        <!-- Заголовок отдела -->
        <div class="department-badge">
            <div class="badge-container">
                <svg class="badge-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z" />
                </svg>
                <span class="badge-text">Отдел Убийств</span>
            </div>
        </div>

        <!-- Главный заголовок -->
        <div class="main-title">
            <h1 class="title">КРИМИНАЛЬНЫЙ<br>БЛЕФ</h1>
            <p class="subtitle">Найди след убийцы</p>
        </div>

        <!-- Информационные карточки -->
        <div class="info-cards">
            <div class="info-card">
                <div class="card-label">Evidence #001</div>
                <div class="card-header">
                    <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                    </svg>
                    <h2 class="card-title">Дело об убийстве</h2>
                </div>
                <p class="card-description">
                    Погрузись в мир жестоких преступлений.
                    Анализируй улики на местах преступлений,
                    выявляй роковые ошибки убийц. 5 кровавых
                    дел ждёт твоего расследования.
                </p>
            </div>

            <div class="info-card">
                <div class="card-label">Evidence #002</div>
                <div class="card-header">
                    <svg class="card-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4M11,17H13V11H11V17M11,9H13V7H11V9Z" />
                    </svg>
                    <h2 class="card-title">Уровни жестокости</h2>
                </div>
                <p class="card-description">
                    От случайных убийств до изощренных
                    серийных преступлений. Время истекает - у
                    тебя 15 секунд, чтобы найти ключевую улику
                    до того, как след простынет.
                </p>
            </div>
        </div>

        <!-- Статистики -->
        <div class="stats-grid">
            <div class="stat-card">
                <svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12,20A8,8 0 0,1 20,12A8,8 0 0,1 12,4A8,8 0 0,1 4,12A8,8 0 0,1 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z" />
                </svg>
                <div class="stat-value">15</div>
                <div class="stat-label">Секунд</div>
            </div>

            <div class="stat-card">
                <svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12,2C13.1,2 14,2.9 14,4C14,5.1 13.1,6 12,6C10.9,6 10,5.1 10,4C10,2.9 10.9,2 12,2M21,9V7L15,1H5C3.89,1 3,1.89 3,3V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V9M19,19H5V19L5,3H14L19,8V19Z" />
                </svg>
                <div class="stat-value">5</div>
                <div class="stat-label">Жертв</div>
            </div>

            <div class="stat-card">
                <svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M17.81,4.47C17.73,4.47 17.65,4.45 17.58,4.41C17.5,4.38 17.42,4.34 17.35,4.29L15.83,3.03C15.69,2.92 15.6,2.76 15.58,2.58C15.56,2.4 15.61,2.22 15.72,2.08L16.76,0.83C16.81,0.78 16.86,0.73 16.92,0.69C17,0.64 17.08,0.61 17.16,0.59C17.24,0.56 17.33,0.56 17.41,0.57C17.5,0.58 17.58,0.6 17.66,0.64L19.36,1.78C19.5,1.89 19.59,2.05 19.61,2.23C19.63,2.41 19.58,2.59 19.47,2.73L18.43,3.98C18.38,4.03 18.33,4.08 18.27,4.12C18.19,4.17 18.11,4.2 18.03,4.22C17.95,4.25 17.86,4.25 17.78,4.24C17.7,4.23 17.62,4.21 17.54,4.17L17.81,4.47M10.25,13.75C10.18,13.75 10.11,13.73 10.05,13.7C9.98,13.67 9.91,13.63 9.85,13.58L8.85,12.73C8.73,12.64 8.65,12.5 8.63,12.34C8.61,12.18 8.65,12.02 8.74,11.89L9.47,10.83C9.5,10.79 9.54,10.75 9.58,10.72C9.64,10.68 9.7,10.65 9.77,10.63C9.83,10.61 9.9,10.6 9.97,10.6C10.04,10.6 10.11,10.61 10.17,10.63L11.26,11.07C11.37,11.11 11.46,11.19 11.52,11.29C11.58,11.39 11.61,11.5 11.61,11.62C11.61,11.74 11.58,11.85 11.52,11.95L10.92,12.78C10.89,12.82 10.85,12.86 10.81,12.89C10.75,12.93 10.69,12.96 10.62,12.98C10.56,13 10.49,13.01 10.42,13.01C10.35,13.01 10.28,13 10.22,12.98L10.25,13.75Z" />
                </svg>
                <div class="stat-value">∞</div>
                <div class="stat-label">Приговор</div>
            </div>

            <div class="stat-card">
                <svg class="stat-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                </svg>
                <div class="stat-value">★</div>
                <div class="stat-label">Профиль</div>
            </div>
        </div>

        <!-- Главная кнопка -->
        <div class="main-action">
            <a href="/game" class="start-button">
                🔍 Вскрыть дело
            </a>
        </div>

        <!-- Навигация -->
        <div class="navigation">
            <a href="/leaderboard" class="nav-button">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16,5V11H21V5M10,11H15V5H10M16,18H21V12H16M10,18H15V12H10M4,18H9V5H4V18Z" />
                </svg>
                <div class="nav-text">Рейтинг</div>
            </a>

            <a href="#" class="nav-button" id="profileBtn">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                </svg>
                <div class="nav-text">Профиль</div>
            </a>
        </div>

        <!-- Подвал -->
        <div class="footer">
            <div class="case-file">Case File #2024 • Classified</div>
        </div>
    </div>

    <script>
        // Инициализация частиц
        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 15;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        // Инициализация Telegram WebApp
        let tg;
        let user;

        function initTelegramWebApp() {
            console.log('[TG WebApp] Инициализация...');

            if (typeof window !== 'undefined' && window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;

                try {
                    tg.ready();
                    console.log('[TG WebApp] Готов к работе');

                    // Получаем данные пользователя
                    user = tg.initDataUnsafe?.user;
                    console.log('[TG WebApp] Данные пользователя:', user);

                    // Расширяем приложение
                    tg.expand();

                    // Настраиваем тему
                    document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#0A0A0A');
                    document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#F5F5DC');

                } catch (error) {
                    console.error('[TG WebApp] Ошибка инициализации:', error);
                }
            } else {
                console.log('[TG WebApp] Запуск вне Telegram');
            }
        }

        // Обработчик кнопки профиля
        async function handleProfileAccess() {
            console.log('[Profile] Доступ к профилю...');

            try {
                // Проверяем существующий токен
                const existingToken = localStorage.getItem('detective_token');
                console.log('[Profile] Существующий токен:', existingToken ? 'есть' : 'нет');

                if (!existingToken) {
                    console.log('[Profile] Токена нет, выполняю авторизацию...');

                    if (!tg || !tg.initData) {
                        console.error('[Profile] Нет данных Telegram WebApp');
                        alert('Ошибка: приложение должно быть запущено из Telegram');
                        return;
                    }

                    console.log('[Profile] Отправляю запрос авторизации...');
                    const response = await fetch('/api/auth/init', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            initData: tg.initData
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('[Profile] Ошибка авторизации:', response.status, errorText);
                        alert('Ошибка авторизации. Попробуйте позже.');
                        return;
                    }

                    const data = await response.json();
                    console.log('[Profile] Авторизация успешна');

                    if (data.token) {
                        localStorage.setItem('detective_token', data.token);
                        console.log('[Profile] Токен сохранён');
                    }
                }

                // Переходим в профиль
                console.log('[Profile] Переход в профиль...');
                window.location.href = '/profile';

            } catch (error) {
                console.error('[Profile] Ошибка:', error);
                alert('Ошибка доступа к профилю. Проверьте соединение и попробуйте снова.');
            }
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function () {
            console.log('[App] Загрузка страницы...');

            // Создаём частицы
            createParticles();

            // Инициализируем Telegram WebApp
            initTelegramWebApp();

            // Настраиваем обработчик кнопки профиля
            const profileBtn = document.getElementById('profileBtn');
            if (profileBtn) {
                profileBtn.addEventListener('click', function (e) {
                    e.preventDefault();
                    handleProfileAccess();
                });
            }

            // Скрываем loader и показываем контент
            setTimeout(() => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('mainContainer').style.opacity = '1';
                console.log('[App] Приложение готово');
            }, 1500);
        });

        // Обработка ошибок
        window.addEventListener('error', function (e) {
            console.error('[App] Глобальная ошибка:', e.error);
        });

        window.addEventListener('unhandledrejection', function (e) {
            console.error('[App] Необработанное отклонение промиса:', e.reason);
        });
    </script>
</body>

</html>