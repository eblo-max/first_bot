<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Криминальный Блеф - Игровой процесс</title>

    <!-- Подключение Telegram WebApp API -->
    <script src="https://telegram.org/js/telegram-web-app.js" crossorigin="anonymous"></script>

    <!-- Инициализация объекта TG и проверка наличия Telegram WebApp API -->
    <script>
        // Эта переменная позволит проверить наличие Telegram WebApp API
        window.tgWebAppReady = !!window.Telegram?.WebApp;

        // Для тестирования - создаем заглушку если в тестовом режиме
        if ((!window.Telegram || !window.Telegram.WebApp) &&
            (window.location.host.includes('localhost') || window.location.search.includes('test=true'))) {

            window.Telegram = {
                WebApp: {
                    ready: function () { console.log('WebApp.ready() вызван'); },
                    expand: function () { console.log('WebApp.expand() вызван'); },
                    initData: window.location.search.substring(window.location.search.indexOf('tgWebAppData=') + 12),
                    initDataUnsafe: {
                        user: {
                            id: 12345678,
                            first_name: "Test",
                            last_name: "User",
                            username: "testuser",
                            language_code: "ru"
                        }
                    },
                    BackButton: {
                        show: function () { console.log('BackButton.show() вызван'); },
                        hide: function () { console.log('BackButton.hide() вызван'); },
                        onClick: function (callback) { console.log('BackButton.onClick() установлен'); }
                    },
                    colorScheme: 'dark',
                    HapticFeedback: {
                        impactOccurred: function () { },
                        notificationOccurred: function () { },
                        selectionChanged: function () { }
                    }
                }
            };
            window.tgWebAppReady = true;
        }
    </script>

    <style>
        :root {
            --dark-bg: #0f0f12;
            --card-bg: #1a1a20;
            --accent-red: #d32f2f;
            --accent-yellow: #ffc107;
            --primary-text: #ffffff;
            --secondary-text: rgba(255, 255, 255, 0.7);
            --muted-text: rgba(255, 255, 255, 0.5);
            --highlight-text: #ffc107;
            --border-color: rgba(255, 255, 255, 0.1);
            --success-color: #4caf50;
            --error-color: #f44336;

            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-full: 9999px;

            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);

            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.4);

            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'SF Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--dark-bg);
            color: var(--primary-text);
            font-family: var(--font-sans);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            position: relative;
        }

        /* Background grid pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.01) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.01) 1px, transparent 1px);
            background-size: 30px 30px;
            z-index: -1;
        }

        .app-container {
            max-width: 450px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: var(--spacing-md);
            position: relative;
            z-index: 2;
            overflow-x: hidden;
        }

        /* Background subtle gradient */
        .background-gradient {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(40, 40, 50, 0.8) 0%, rgba(15, 15, 18, 1) 100%);
            z-index: -2;
        }

        /* Header with game status */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            position: relative;
        }

        .case-badge {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            background: var(--card-bg);
            padding: 8px 12px;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .case-icon {
            width: 18px;
            height: 18px;
            color: var(--accent-yellow);
        }

        .case-number {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-text);
            letter-spacing: 0.5px;
        }

        .score-badge {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            background: var(--card-bg);
            padding: 8px 12px;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .score-icon {
            width: 18px;
            height: 18px;
            color: var(--accent-yellow);
        }

        .score-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-text);
            letter-spacing: 0.5px;
        }

        .profile-link {
            background: none;
            border: none;
            color: var(--primary-text);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
        }

        .profile-link:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: rgba(40, 40, 50, 1);
        }

        .profile-link:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .profile-icon {
            width: 20px;
            height: 20px;
            color: var(--accent-yellow);
        }

        /* Compact Blood Capsule Timer */
        .timer-container {
            position: relative;
            margin-bottom: var(--spacing-lg);
            padding: 12px 16px;
            background: linear-gradient(145deg,
                    rgba(15, 15, 25, 0.9),
                    rgba(25, 25, 35, 0.8),
                    rgba(15, 15, 25, 0.9));
            border-radius: 12px;
            backdrop-filter: blur(8px);
            box-shadow:
                0 3px 12px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .timer-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg,
                    rgba(211, 47, 47, 0.02) 0%,
                    rgba(65, 65, 75, 0.02) 50%,
                    rgba(211, 47, 47, 0.02) 100%);
            animation: subtle-glow 4s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes subtle-glow {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 0.5;
            }
        }

        .timer-label {
            position: relative;
            margin-bottom: 8px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--accent-red);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
            text-shadow: 0 0 6px rgba(211, 47, 47, 0.5);
            z-index: 2;
            justify-content: center;
        }

        .timer-icon {
            width: 12px;
            height: 12px;
            color: var(--accent-red);
            filter: drop-shadow(0 0 3px rgba(211, 47, 47, 0.6));
            animation: pulse-icon 2s ease-in-out infinite;
        }

        @keyframes pulse-icon {

            0%,
            100% {
                transform: scale(1);
                filter: drop-shadow(0 0 3px rgba(211, 47, 47, 0.6));
            }

            50% {
                transform: scale(1.08);
                filter: drop-shadow(0 0 6px rgba(211, 47, 47, 0.8));
            }
        }

        /* Blood Capsule Design */
        .timer-outer {
            position: relative;
            height: 32px;
            max-width: 240px;
            margin: 0 auto;
            border-radius: 16px;
            background: linear-gradient(145deg,
                    rgba(245, 245, 250, 0.96),
                    rgba(225, 225, 235, 0.92),
                    rgba(245, 245, 250, 0.96));
            box-shadow:
                inset 0 1px 6px rgba(0, 0, 0, 0.08),
                inset 0 -1px 3px rgba(255, 255, 255, 0.4),
                0 2px 8px rgba(0, 0, 0, 0.15);
            border: 1.5px solid rgba(255, 255, 255, 0.9);
            overflow: hidden;
            z-index: 1;
        }

        /* Glass reflection effect */
        .timer-outer::before {
            content: '';
            position: absolute;
            top: 1px;
            left: 1px;
            right: 1px;
            height: 45%;
            background: linear-gradient(180deg,
                    rgba(255, 255, 255, 0.5) 0%,
                    rgba(255, 255, 255, 0.15) 60%,
                    transparent 100%);
            border-radius: 15px 15px 6px 6px;
            z-index: 10;
        }

        .timer-section {
            position: relative;
            height: 100%;
            border-radius: 15px;
            overflow: hidden;
            background: radial-gradient(ellipse at center,
                    rgba(25, 25, 35, 0.7) 0%,
                    rgba(15, 15, 25, 0.8) 70%,
                    rgba(5, 5, 15, 0.9) 100%);
        }

        /* Blood Liquid Fill - flowing from right to left */
        .timer-fill {
            position: absolute;
            top: 1px;
            left: 1px;
            bottom: 1px;
            width: calc(75% - 2px);
            background: linear-gradient(180deg,
                    rgba(140, 15, 15, 1) 0%,
                    rgba(170, 25, 25, 1) 25%,
                    rgba(190, 35, 35, 0.98) 50%,
                    rgba(210, 50, 50, 0.95) 75%,
                    rgba(230, 65, 65, 0.9) 100%);
            z-index: 3;
            border-radius: 14px;
            box-shadow:
                inset 0 1px 6px rgba(80, 0, 0, 0.6),
                inset 0 -1px 3px rgba(255, 80, 80, 0.4),
                0 0 12px rgba(211, 47, 47, 0.3);
            overflow: hidden;
            transform-origin: right center;
        }

        /* Blood surface with subtle waves - only when countdown active */
        .timer-fill.countdown::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg,
                    rgba(255, 120, 120, 0.9) 0%,
                    rgba(255, 80, 80, 1) 25%,
                    rgba(255, 120, 120, 0.9) 50%,
                    rgba(255, 80, 80, 1) 75%,
                    rgba(255, 120, 120, 0.9) 100%);
            animation: blood-surface-wave 2s ease-in-out infinite;
            border-radius: 14px 14px 0 0;
        }

        /* Bubble system inside blood - only when countdown active */
        .timer-fill.countdown::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle 2px at 25% 75%, rgba(255, 255, 255, 0.4) 0%, transparent 50%),
                radial-gradient(circle 1.5px at 65% 65%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle 2.5px at 85% 80%, rgba(255, 255, 255, 0.35) 0%, transparent 50%),
                radial-gradient(circle 1px at 45% 60%, rgba(255, 255, 255, 0.4) 0%, transparent 50%),
                radial-gradient(circle 2px at 15% 45%, rgba(255, 255, 255, 0.3) 0%, transparent 50%);
            animation: bubbles-float 3.5s ease-in-out infinite;
        }

        .timer-fill.countdown {
            animation:
                timer-countdown-ltr 60s linear forwards,
                blood-flow 3s ease-in-out infinite,
                blood-pulse 2s ease-in-out infinite;
        }

        @keyframes blood-flow {

            0%,
            100% {
                filter: hue-rotate(0deg) saturate(1.1) brightness(1);
            }

            50% {
                filter: hue-rotate(-8deg) saturate(1.25) brightness(1.05);
            }
        }

        @keyframes blood-pulse {

            0%,
            100% {
                box-shadow:
                    inset 0 1px 6px rgba(80, 0, 0, 0.6),
                    inset 0 -1px 3px rgba(255, 80, 80, 0.4),
                    0 0 12px rgba(211, 47, 47, 0.3);
            }

            50% {
                box-shadow:
                    inset 0 1px 6px rgba(100, 0, 0, 0.7),
                    inset 0 -1px 3px rgba(255, 100, 100, 0.5),
                    0 0 18px rgba(211, 47, 47, 0.5);
            }
        }

        @keyframes blood-surface-wave {

            0%,
            100% {
                transform: translateY(0px);
                opacity: 0.9;
            }

            50% {
                transform: translateY(-0.5px);
                opacity: 1;
            }
        }

        @keyframes bubbles-float {
            0% {
                background-position:
                    25% 75%, 65% 65%, 85% 80%, 45% 60%, 15% 45%;
            }

            25% {
                background-position:
                    27% 70%, 63% 60%, 83% 75%, 43% 55%, 17% 40%;
            }

            50% {
                background-position:
                    30% 65%, 60% 55%, 80% 70%, 40% 50%, 20% 35%;
            }

            75% {
                background-position:
                    28% 70%, 62% 60%, 82% 75%, 42% 55%, 18% 40%;
            }

            100% {
                background-position:
                    25% 75%, 65% 65%, 85% 80%, 45% 60%, 15% 45%;
            }
        }

        /* Blood flows from right to left (shrinks from right side) */
        @keyframes timer-countdown-ltr {
            from {
                width: calc(75% - 2px);
            }

            to {
                width: 0%;
            }
        }

        /* Timer reset animation for new questions */
        @keyframes timer-reset {
            from {
                width: 0%;
            }

            to {
                width: calc(75% - 2px);
            }
        }

        .timer-fill.reset {
            animation: timer-reset 0.3s ease-out forwards;
        }

        /* Compact timer display */
        .timer-value-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 64px;
            height: 22px;
            border-radius: 6px;
            background: linear-gradient(145deg,
                    rgba(0, 0, 0, 0.92),
                    rgba(15, 15, 25, 0.96),
                    rgba(0, 0, 0, 0.92));
            box-shadow:
                0 1px 8px rgba(0, 0, 0, 0.6),
                0 0 10px rgba(211, 47, 47, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(211, 47, 47, 0.3);
            backdrop-filter: blur(6px);
        }

        .timer-value {
            font-size: 13px;
            font-weight: 700;
            color: #ffffff;
            font-family: var(--font-mono);
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1px;
            text-shadow:
                0 0 6px rgba(255, 255, 255, 0.6),
                0 0 12px rgba(255, 255, 255, 0.2),
                0 1px 1px rgba(0, 0, 0, 0.5);
            filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.3));
        }

        .timer-blink {
            color: var(--accent-red);
            animation: advanced-blink 1s ease-in-out infinite;
            display: inline-block;
            transform: translateY(-0.5px);
            margin: 0 0.5px;
            text-shadow:
                0 0 4px rgba(211, 47, 47, 0.8),
                0 0 8px rgba(211, 47, 47, 0.4),
                0 0 12px rgba(211, 47, 47, 0.2);
        }

        @keyframes advanced-blink {

            0%,
            100% {
                opacity: 1;
                transform: translateY(-0.5px) scale(1);
                text-shadow:
                    0 0 4px rgba(211, 47, 47, 0.8),
                    0 0 8px rgba(211, 47, 47, 0.4),
                    0 0 12px rgba(211, 47, 47, 0.2);
            }

            50% {
                opacity: 0.4;
                transform: translateY(-0.5px) scale(0.96);
                text-shadow:
                    0 0 2px rgba(211, 47, 47, 0.5),
                    0 0 4px rgba(211, 47, 47, 0.2);
            }
        }

        /* Minimal markers on glass */
        .timer-markers {
            position: absolute;
            top: 4px;
            left: 6px;
            right: 6px;
            height: 3px;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .timer-marker {
            width: 0.5px;
            height: 1.5px;
            background: rgba(0, 0, 0, 0.15);
            opacity: 0;
            animation: marker-fade-in 2s ease-out forwards;
        }

        .timer-marker:nth-child(5n) {
            height: 3px;
            width: 1px;
            background: rgba(0, 0, 0, 0.25);
        }

        @keyframes marker-fade-in {
            0% {
                opacity: 0;
                transform: translateY(1px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced remaining indicator */
        .remaining-indicator {
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--accent-red);
            font-weight: 600;
            text-shadow: 0 0 4px rgba(211, 47, 47, 0.4);
            position: relative;
            z-index: 2;
        }

        .red-dot {
            width: 4px;
            height: 4px;
            background: radial-gradient(circle,
                    rgba(255, 255, 255, 1) 0%,
                    rgba(211, 47, 47, 1) 35%,
                    rgba(140, 25, 25, 0.8) 100%);
            border-radius: 50%;
            animation: dot-pulse 1.5s ease-in-out infinite;
            box-shadow:
                0 0 6px rgba(211, 47, 47, 0.6),
                0 0 12px rgba(211, 47, 47, 0.2);
        }

        @keyframes dot-pulse {

            0%,
            100% {
                transform: scale(1);
                box-shadow:
                    0 0 6px rgba(211, 47, 47, 0.6),
                    0 0 12px rgba(211, 47, 47, 0.2);
            }

            50% {
                transform: scale(1.15);
                box-shadow:
                    0 0 8px rgba(211, 47, 47, 0.8),
                    0 0 16px rgba(211, 47, 47, 0.4),
                    0 0 24px rgba(211, 47, 47, 0.15);
            }
        }

        /* Remove old unused effects */
        .timer-background,
        .timer-noise,
        .timer-notches,
        .timer-glow,
        .timer-ripple,
        .timer-particles,
        .timer-edge,
        .timer-scanline,
        .laser-sight {
            display: none;
        }

        /* Case File Content */
        .case-file {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .case-file::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-red);
        }

        .case-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            letter-spacing: 0.5px;
            color: var(--primary-text);
            text-transform: uppercase;
        }

        .evidence-tag {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(211, 47, 47, 0.2);
            color: var(--accent-yellow);
            font-size: 10px;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            backdrop-filter: blur(4px);
        }

        .case-metadata {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .metadata-item {
            font-size: 12px;
            color: var(--muted-text);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .metadata-icon {
            width: 12px;
            height: 12px;
            opacity: 0.7;
        }

        .case-content {
            font-size: 16px;
            line-height: 1.6;
            color: var(--secondary-text);
            margin-bottom: var(--spacing-md);
        }

        .highlighted-text {
            color: var(--highlight-text);
            font-weight: 500;
        }

        .case-question {
            font-size: 16px;
            font-weight: 600;
            color: var(--highlight-text);
            margin-top: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--highlight-text);
        }

        /* Answer Options */
        .answers-section {
            margin-bottom: var(--spacing-xl);
            position: relative;
        }

        .answers-label {
            position: relative;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-red);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .answers-icon {
            width: 16px;
            height: 16px;
            color: var(--accent-red);
        }

        .answer-option {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
        }

        .answer-option:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: rgba(40, 40, 50, 1);
        }

        .answer-option:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        /* Стиль для заблокированных вариантов ответов */
        .answer-option.disabled {
            opacity: 0.7;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Стиль для выделения правильного ответа при истечении времени */
        .answer-option.correct-answer {
            border-color: var(--success-color);
            background: rgba(76, 175, 80, 0.1);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
            opacity: 1;
        }

        .answer-option.correct-answer .answer-marker {
            background: var(--success-color);
            color: var(--dark-bg);
            border-color: var(--success-color);
        }

        .answer-marker {
            width: 28px;
            height: 28px;
            min-width: 28px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--primary-text);
            margin-top: 2px;
            transition: all var(--transition-normal);
        }

        .answer-option:hover .answer-marker {
            background: rgba(255, 255, 255, 0.1);
        }

        .answer-option.selected {
            border-color: var(--accent-yellow);
            background: rgba(255, 193, 7, 0.1);
        }

        .answer-option.selected .answer-marker {
            background: var(--accent-yellow);
            color: var(--dark-bg);
            border-color: var(--accent-yellow);
        }

        .answer-text {
            font-size: 15px;
            line-height: 1.5;
            color: var(--secondary-text);
        }

        .answer-option.selected .answer-text {
            color: var(--primary-text);
        }

        /* Results Section (Initially Hidden) */
        .results-section {
            display: none;
            /* Will be toggled with JS in real app */
            background: var(--card-bg);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            box-shadow: var(--shadow-md);
        }

        .result-correct {
            border-color: var(--success-color);
        }

        .result-correct::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--success-color);
        }

        .result-incorrect {
            border-color: var(--error-color);
        }

        .result-incorrect::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--error-color);
        }

        .result-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
        }

        .result-correct .result-badge {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success-color);
        }

        .result-incorrect .result-badge {
            background: rgba(244, 67, 54, 0.2);
            color: var(--error-color);
        }

        .result-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            letter-spacing: 0.5px;
        }

        .result-correct .result-header {
            color: var(--success-color);
        }

        .result-incorrect .result-header {
            color: var(--error-color);
        }

        .result-explanation {
            font-size: 15px;
            line-height: 1.6;
            color: var(--secondary-text);
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
        }

        .result-points {
            font-size: 16px;
            font-weight: 600;
            color: var(--highlight-text);
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(255, 193, 7, 0.1);
            border-radius: var(--radius-full);
            display: inline-block;
        }

        .points-value {
            position: relative;
            display: inline-block;
        }

        .points-value::before {
            content: '+';
            margin-right: 2px;
            font-weight: 700;
            color: var(--success-color);
        }

        /* Footer Button */
        .game-footer {
            margin-top: auto;
            padding-top: var(--spacing-md);
        }

        .action-button {
            width: 100%;
            padding: var(--spacing-md);
            background: var(--accent-red);
            color: var(--primary-text);
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: #e53935;
            /* Lighter red */
        }

        .action-button:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .action-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .action-button:hover::after {
            left: 100%;
        }

        /* Modern subtle details */
        .glass-effect {
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        /* Crime scene theme elements */
        .crime-scene-pattern {
            position: absolute;
            bottom: 5%;
            right: 5%;
            width: 200px;
            height: 200px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Cpath d='M100 0 C60 0 20 40 20 100 C20 160 60 200 120 200 C160 200 180 180 180 140 C180 100 160 80 120 80 C100 80 80 100 80 120 C80 140 100 160 120 160 C140 160 160 140 160 120' stroke='%23444' stroke-width='0.6' fill='none' opacity='0.04'/%3E%3C/svg%3E");
            opacity: 0.05;
            z-index: -1;
        }

        /* Show results instead of options when answer is selected */
        .answered .answers-section {
            display: none;
        }

        .answered .results-section {
            display: block;
        }

        /* Responsive adjustments */
        @media (max-width: 380px) {
            .case-title {
                font-size: 18px;
            }

            .case-content {
                font-size: 14px;
            }

            .answer-text {
                font-size: 14px;
            }

            .action-button {
                font-size: 14px;
                padding: var(--spacing-sm) var(--spacing-md);
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }
    </style>
</head>

<body>
    <div class="background-gradient"></div>
    <div class="app-container">
        <div class="crime-scene-pattern"></div>

        <header class="game-header">
            <div class="case-badge">
                <svg class="case-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm10 16H4V8h16v12z" />
                </svg>
                <span class="case-number">ДЕЛО <span id="question-progress">1/5</span></span>
            </div>

            <div class="score-badge">
                <svg class="score-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 15V3m0 12l-4 4m4-4l4 4M3 12h18" />
                </svg>
                <span class="score-value"><span id="score-display">0</span> ОЧКОВ</span>
            </div>

            <button class="profile-link">
                <svg class="profile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg>
            </button>
        </header>

        <div class="timer-container">
            <div class="timer-label">
                <svg class="timer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M12 6v6l4 2" />
                </svg>
                ВРЕМЯ НА РАЗГАДКУ
            </div>
            <div class="timer-outer">
                <div class="timer-section">
                    <div class="timer-background"></div>
                    <div class="timer-noise"></div>
                    <div class="timer-markers">
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                        <div class="timer-marker"></div>
                    </div>
                    <div class="timer-notches">
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                        <div class="timer-notch"></div>
                    </div>
                    <div class="timer-glow"></div>
                    <div class="timer-fill countdown" id="timer-bar"></div>
                    <div class="timer-ripple"></div>
                    <div class="timer-particles">
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                        <div class="particle"></div>
                    </div>
                    <div class="timer-edge"></div>
                    <div class="timer-scanline"></div>
                    <div class="laser-sight"></div>
                    <div class="timer-value-container">
                        <div class="timer-value"><span id="timer-value">60</span><span class="timer-blink">:</span>00
                        </div>
                    </div>
                </div>
            </div>
            <div class="remaining-indicator">
                <span class="red-dot"></span>
                ВРЕМЯ ИДЕТ
            </div>
        </div>

        <section class="case-file glass-effect">
            <div class="evidence-tag">УЛИКА #<span id="story-evidence-id">01</span></div>
            <h2 class="case-title" id="story-title">ОГРАБЛЕНИЕ ЮВЕЛИРНОГО МАГАЗИНА</h2>

            <div class="case-metadata">
                <div class="metadata-item">
                    <svg class="metadata-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                    <span id="story-date">12.04.2024</span>
                </div>
                <div class="metadata-item">
                    <svg class="metadata-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    </svg>
                    <span id="story-difficulty">СЛОЖНОСТЬ: СРЕДНЯЯ</span>
                </div>
            </div>

            <div class="case-content" id="story-content">
                Преступник взломал заднюю дверь ювелирного магазина в 3 часа ночи. Он отключил камеры видеонаблюдения,
                но не заметил <span class="highlighted-text">скрытую камеру над сейфом</span>. На записи видно, как он
                <span class="highlighted-text">без перчаток</span> открывает витрины и собирает украшения в рюкзак.
                Перед уходом преступник воспользовался <span class="highlighted-text">раковиной в подсобке</span>, чтобы
                смыть кровь с пореза на руке.
            </div>

            <div class="mission-container">
                <div class="mission-line"></div>
                <div class="mission-question">Какую роковую ошибку допустил преступник?</div>
            </div>
        </section>

        <section class="answers-section">
            <div class="answers-label">
                <svg class="answers-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                </svg>
                ВАРИАНТЫ ОТВЕТОВ
            </div>

            <div id="answers-container">
                <div class="answer-option" data-mistake-id="mistake-1" data-action="selectAnswer">
                    <div class="answer-marker">A</div>
                    <div class="answer-text">
                        Неправильно отключил систему видеонаблюдения, не заметив скрытую камеру
                    </div>
                </div>

                <div class="answer-option" data-mistake-id="mistake-2" data-action="selectAnswer">
                    <div class="answer-marker">B</div>
                    <div class="answer-text">
                        Работал без перчаток, оставив отпечатки пальцев на витринах и украшениях
                    </div>
                </div>

                <div class="answer-option" data-mistake-id="mistake-3" data-action="selectAnswer">
                    <div class="answer-marker">C</div>
                    <div class="answer-text">
                        Оставил свои биологические следы, смыв кровь в раковине, что позволило получить его ДНК
                    </div>
                </div>
            </div>
        </section>

        <section class="results-section result-correct" id="result-section" style="display:none">
            <div class="result-badge" id="result-badge">ВЕРНО</div>

            <h3 class="result-header" id="result-header">Правильно!</h3>
            <div class="result-explanation" id="result-explanation">
                Преступник оставил биологический материал (кровь), который попал в слив раковины. Даже после смывания,
                следы ДНК остаются на сантехнике и в трубах. Криминалисты легко извлекают такие образцы и используют для
                идентификации. Современные методы могут выделить ДНК-профиль даже из микроскопических следов крови.
            </div>
            <div class="result-points" id="result-points"><span class="points-value">120</span> ОЧКОВ</div>
        </section>

        <footer class="game-footer">
            <button class="action-button" id="action-button" data-action="nextQuestion">СЛЕДУЮЩЕЕ ДЕЛО</button>
        </footer>
    </div>

    <!-- Скрипты игры -->
    <script src="achievement-system.js"></script>
    <script src="game-interface.js"></script>
    <script src="crime-app.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Инициализация Telegram WebApp
            if (window.Telegram?.WebApp) {
                // Расширяем WebApp
                window.Telegram.WebApp.expand();

                // Показываем кнопку "Назад" при запуске игры
                window.Telegram.WebApp.BackButton.show();

                // Настраиваем обработчик кнопки "Назад"
                window.Telegram.WebApp.BackButton.onClick(function () {
                    if (confirm('Вы уверены, что хотите прервать игру?')) {
                        window.location.href = '/';
                    }
                });
            }

            // Обработчики событий для элементов игрового интерфейса
            document.querySelectorAll('.answer-option').forEach(function (option) {
                option.addEventListener('click', function () {
                    // Получаем ID ошибки из атрибута data-mistake-id
                    const mistakeId = this.getAttribute('data-mistake-id');

                    // Удаляем класс selected у всех опций
                    document.querySelectorAll('.answer-option').forEach(function (opt) {
                        opt.classList.remove('selected');
                    });

                    // Добавляем класс selected к выбранной опции
                    this.classList.add('selected');

                    // Визуальный и тактильный отклик
                    if (window.Telegram?.WebApp?.HapticFeedback) {
                        window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
                    }

                    // Проверяем, является ли выбранный ответ правильным
                    const isCorrect = mistakeId === 'mistake-3'; // В данном примере правильный ответ всегда C

                    // Показываем раздел с результатом
                    const resultSection = document.getElementById('result-section');
                    resultSection.style.display = 'block';

                    if (isCorrect) {
                        resultSection.className = 'results-section result-correct';
                        document.getElementById('result-badge').textContent = 'ВЕРНО';
                        document.getElementById('result-header').textContent = 'Правильно!';
                        document.getElementById('result-explanation').textContent = 'Преступник оставил биологический материал (кровь), который попал в слив раковины. Даже после смывания, следы ДНК остаются на сантехнике и в трубах. Криминалисты легко извлекают такие образцы и используют для идентификации.';
                        document.getElementById('result-points').innerHTML = '<span class="points-value">120</span> ОЧКОВ';
                    } else {
                        resultSection.className = 'results-section result-incorrect';
                        document.getElementById('result-badge').textContent = 'ОШИБКА';
                        document.getElementById('result-header').textContent = 'Неправильно!';
                        document.getElementById('result-explanation').textContent = 'Преступник оставил биологический материал (кровь), который попал в слив раковины. Даже после смывания, следы ДНК остаются на сантехнике и в трубах. Криминалисты легко извлекают такие образцы и используют для идентификации.';
                        document.getElementById('result-points').innerHTML = '<span class="points-value">0</span> ОЧКОВ';
                    }
                });
            });

            // Обработчик кнопки "Следующее дело"
            document.getElementById('action-button').addEventListener('click', function () {
                // В реальном приложении здесь был бы переход к следующему делу

                // Сбрасываем таймер для следующего дела
                resetTimer();

                // Сбрасываем результаты
                document.getElementById('result-section').style.display = 'none';

                // Сбрасываем выбранные ответы
                document.querySelectorAll('.answer-option').forEach(function (option) {
                    option.classList.remove('selected', 'disabled', 'correct-answer');
                });

                // или window.location.href = '/game?next=true';
            });

            // Запускаем таймер
            let secondsLeft = 60;
            let timer;

            function startTimer() {
                timer = setInterval(function () {
                    secondsLeft--;
                    document.getElementById('timer-value').textContent = secondsLeft;

                    if (secondsLeft <= 10) {
                        document.querySelector('.timer-container').classList.add('urgent');

                        // Тактильный отклик при низком времени
                        if (window.Telegram?.WebApp?.HapticFeedback) {
                            window.Telegram.WebApp.HapticFeedback.notificationOccurred('warning');
                        }
                    }

                    if (secondsLeft <= 0) {
                        clearInterval(timer);
                        // Время истекло - показываем правильный ответ
                        document.querySelectorAll('.answer-option').forEach(function (option) {
                            option.classList.add('disabled');
                            if (option.getAttribute('data-mistake-id') === 'mistake-3') {
                                option.classList.add('correct-answer');
                            }
                        });
                    }
                }, 1000);
            }

            function resetTimer() {
                // Останавливаем старый таймер
                if (timer) {
                    clearInterval(timer);
                }

                // Сбрасываем значения
                secondsLeft = 60;
                document.getElementById('timer-value').textContent = secondsLeft;
                document.querySelector('.timer-container').classList.remove('urgent');

                // Сбрасываем анимацию полоски
                const timerBar = document.getElementById('timer-bar');
                timerBar.classList.remove('countdown');
                timerBar.classList.add('reset');

                // Через короткую задержку запускаем новую анимацию
                setTimeout(function () {
                    timerBar.classList.remove('reset');
                    timerBar.classList.add('countdown');
                    startTimer();
                }, 300);
            }

            // Запускаем таймер при загрузке
            startTimer();

            // Сообщаем Telegram, что приложение готово
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.ready();
            }
        });
    </script>
</body>

</html>