<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Криминальный Блеф</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">

    <!-- Подключение Telegram WebApp API ПЕРВЫМ -->
    <script src="https://telegram.org/js/telegram-web-app.js" crossorigin="anonymous"></script>

    <!-- Инициализация объекта TG и проверка наличия Telegram WebApp API -->
    <script>
        // Эта переменная позволит проверить наличие Telegram WebApp API
        window.tgWebAppReady = !!window.Telegram?.WebApp;

        // Для тестирования - создаем заглушку если в тестовом режиме
        if ((!window.Telegram || !window.Telegram.WebApp) &&
            (window.location.host.includes('localhost') || window.location.search.includes('test=true'))) {
            console.log('Создаем заглушку для тестирования');
            window.Telegram = {
                WebApp: {
                    ready: function () { console.log('WebApp.ready() вызван'); },
                    expand: function () { console.log('WebApp.expand() вызван'); },
                    initData: window.location.search.substring(window.location.search.indexOf('tgWebAppData=') + 12),
                    initDataUnsafe: {
                        user: {
                            id: 12345678,
                            first_name: "Test",
                            last_name: "User",
                            username: "testuser",
                            language_code: "ru"
                        }
                    },
                    BackButton: {
                        show: function () { console.log('BackButton.show() вызван'); },
                        hide: function () { console.log('BackButton.hide() вызван'); },
                        onClick: function (callback) { console.log('BackButton.onClick() установлен'); }
                    },
                    colorScheme: 'dark',
                    HapticFeedback: {
                        impactOccurred: function () { },
                        notificationOccurred: function () { },
                        selectionChanged: function () { }
                    }
                }
            };
            window.tgWebAppReady = true;
        }
    </script>

    <!-- Fallback проверка состояния приложения -->
    <script>
        // Таймаут безопасности для отображения UI, если что-то пошло не так
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.querySelector('.loading-container').style.display = 'none';
                document.querySelector('.app-container').style.display = 'flex';
            }, 1000);
        });
    </script>

    <style>
        :root {
            --dark-bg: #0f0f12;
            --card-bg: #1a1a20;
            --accent-red: #d32f2f;
            --accent-yellow: #ffc107;
            --primary-text: #ffffff;
            --secondary-text: rgba(255, 255, 255, 0.7);
            --muted-text: rgba(255, 255, 255, 0.5);
            --highlight-text: #ffc107;
            --border-color: rgba(255, 255, 255, 0.1);
            --success-color: #4caf50;
            --error-color: #f44336;

            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;

            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-full: 9999px;

            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);

            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.4);

            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'SF Mono', 'Roboto Mono', Menlo, Monaco, Consolas, monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--dark-bg);
            color: var(--primary-text);
            font-family: var(--font-sans);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            position: relative;
        }

        /* Background grid pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.01) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.01) 1px, transparent 1px);
            background-size: 30px 30px;
            z-index: -1;
        }

        .app-container {
            max-width: 450px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: var(--spacing-md);
            position: relative;
            z-index: 2;
            overflow-x: hidden;
        }

        /* Background subtle gradient */
        .background-gradient {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(40, 40, 50, 0.8) 0%, rgba(15, 15, 18, 1) 100%);
            z-index: -2;
        }

        /* Контейнер для сообщения загрузки */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--dark-bg);
            z-index: 100;
        }

        .loader {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--spacing-md);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-container p {
            font-size: 16px;
            color: var(--secondary-text);
        }

        /* Case File Content */
        .case-file {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .case-file::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-red);
        }

        .case-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            letter-spacing: 0.5px;
            color: var(--primary-text);
            text-transform: uppercase;
        }

        .evidence-tag {
            position: absolute;
            top: -10px;
            right: 15px;
            background: var(--accent-red);
            color: #fff;
            padding: 4px 8px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 1px;
            border-radius: 3px;
            text-transform: uppercase;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .case-metadata {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .metadata-item {
            font-size: 12px;
            color: var(--muted-text);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .metadata-icon {
            width: 12px;
            height: 12px;
            opacity: 0.7;
        }

        .case-content {
            font-size: 16px;
            line-height: 1.6;
            color: var(--secondary-text);
            margin-bottom: var(--spacing-md);
        }

        .case-content a {
            color: var(--accent-red);
            text-decoration: none;
            font-weight: 500;
        }

        .case-content a:hover {
            text-decoration: underline;
        }

        .highlighted-text {
            color: var(--accent-yellow);
            font-weight: 500;
            position: relative;
            display: inline;
            padding: 0 2px;
        }

        .case-question {
            font-size: 18px;
            font-weight: 600;
            margin-top: var(--spacing-lg);
            color: var(--primary-text);
            position: relative;
            padding-left: var(--spacing-lg);
            border-left: 3px solid var(--accent-red);
        }

        .mission-container {
            position: relative;
            margin: var(--spacing-lg) 0;
            padding-left: var(--spacing-md);
            border-left: 3px solid var(--accent-red);
        }

        .mission-question {
            font-size: 17px;
            font-weight: 600;
            color: var(--primary-text);
            line-height: 1.4;
            position: relative;
            padding-left: var(--spacing-sm);
        }

        .mission-line {
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 15px;
            height: 3px;
            background: var(--accent-red);
        }

        /* Answer Options */
        .answers-section {
            margin-bottom: var(--spacing-xl);
            position: relative;
        }

        .answers-label {
            position: relative;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-red);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .answers-icon {
            width: 16px;
            height: 16px;
            color: var(--accent-red);
        }

        .answer-option {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            padding: 14px 16px;
            margin-bottom: var(--spacing-sm);
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            position: relative;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .answer-option::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-yellow);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .answer-option:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .answer-option.selected {
            border-color: var(--accent-yellow);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.15);
        }

        .answer-option.selected::before {
            opacity: 1;
        }

        .answer-marker {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
            color: var(--accent-yellow);
            margin-right: var(--spacing-md);
            flex-shrink: 0;
            transition: all var(--transition-normal);
        }

        .answer-text {
            font-size: 15px;
            line-height: 1.4;
            color: var(--primary-text);
            flex: 1;
            letter-spacing: 0.2px;
        }

        .answer-option.selected .answer-marker {
            background: var(--accent-yellow);
            color: var(--dark-bg);
        }

        .answer-option.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Results Section */
        .results-section {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            box-shadow: var(--shadow-md);
        }

        .result-correct {
            border-color: var(--success-color);
        }

        .result-correct::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--success-color);
        }

        .result-incorrect {
            border-color: var(--error-color);
        }

        .result-incorrect::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--error-color);
        }

        .result-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
        }

        .result-correct .result-badge {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success-color);
        }

        .result-incorrect .result-badge {
            background: rgba(244, 67, 54, 0.2);
            color: var(--error-color);
        }

        .result-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            letter-spacing: 0.5px;
        }

        .result-correct .result-header {
            color: var(--success-color);
        }

        .result-incorrect .result-header {
            color: var(--error-color);
        }

        .result-explanation {
            font-size: 15px;
            line-height: 1.6;
            color: var(--secondary-text);
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
        }

        .result-points {
            font-size: 16px;
            font-weight: 600;
            color: var(--highlight-text);
            padding: var(--spacing-sm) var(--spacing-md);
            background: rgba(255, 193, 7, 0.1);
            border-radius: var(--radius-full);
            display: inline-block;
            margin-bottom: var(--spacing-lg);
        }

        .points-value {
            position: relative;
            display: inline-block;
        }

        .points-value::before {
            content: '+';
            margin-right: 2px;
            font-weight: 700;
            color: var(--success-color);
        }

        /* Footer Button */
        .game-footer {
            margin-top: auto;
            padding-top: var(--spacing-md);
            position: fixed;
            bottom: 16px;
            left: 16px;
            right: 16px;
            max-width: 450px;
            width: calc(100% - 32px);
            margin-left: auto;
            margin-right: auto;
            z-index: 10;
        }

        .action-button {
            width: 100%;
            padding: 14px;
            background: var(--accent-red);
            color: var(--primary-text);
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: #e53935;
            /* Lighter red */
        }

        .action-button:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .action-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .action-button:hover::after {
            left: 100%;
        }

        /* Modern subtle details */
        .glass-effect {
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        /* Crime scene theme elements */
        .crime-scene-pattern {
            position: absolute;
            bottom: 5%;
            right: 5%;
            width: 200px;
            height: 200px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Cpath d='M100 0 C60 0 20 40 20 100 C20 160 60 200 120 200 C160 200 180 180 180 140 C180 100 160 80 120 80 C100 80 80 100 80 120 C80 140 100 160 120 160 C140 160 160 140 160 120' stroke='%23444' stroke-width='0.6' fill='none' opacity='0.04'/%3E%3C/svg%3E");
            opacity: 0.05;
            z-index: -1;
        }

        /* Screens management */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Results styles */
        .results-details {
            margin-bottom: var(--spacing-lg);
        }

        .results-details p,
        .results-stats p {
            margin-bottom: var(--spacing-xs);
            font-size: 15px;
        }

        .results-stats h3 {
            font-size: 18px;
            margin-bottom: var(--spacing-sm);
            color: var(--accent-yellow);
        }

        /* Responsive adjustments */
        @media (max-width: 380px) {
            .case-title {
                font-size: 18px;
            }

            .case-content {
                font-size: 14px;
            }

            .answer-text {
                font-size: 14px;
            }

            .action-button {
                font-size: 14px;
                padding: var(--spacing-sm) var(--spacing-md);
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }

        /* Header with game status */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            position: relative;
        }

        .case-badge {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            background: var(--card-bg);
            padding: 8px 12px;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .case-icon {
            width: 18px;
            height: 18px;
            color: var(--accent-yellow);
        }

        .case-number {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-text);
            letter-spacing: 0.5px;
        }

        .score-badge {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            background: var(--card-bg);
            padding: 8px 12px;
            border-radius: var(--radius-full);
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .score-icon {
            width: 18px;
            height: 18px;
            color: var(--accent-yellow);
        }

        .score-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-text);
            letter-spacing: 0.5px;
        }

        .profile-link {
            background: none;
            border: none;
            color: var(--primary-text);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
        }

        .profile-icon {
            width: 20px;
            height: 20px;
            color: #fff;
        }

        /* High-tech Timer Section */
        .timer-container {
            position: relative;
            margin-bottom: var(--spacing-xl);
            padding: 2px;
            background: linear-gradient(90deg, rgba(211, 47, 47, 0.2), rgba(65, 65, 75, 0.2));
            border-radius: 3px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .timer-outer {
            position: relative;
            border-radius: 2px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.7);
            background: rgba(15, 15, 20, 0.7);
            backdrop-filter: blur(4px);
            height: 24px;
            padding: 3px;
        }

        .timer-label {
            position: absolute;
            top: -22px;
            left: 0;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-red);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            text-shadow: 0 0 5px rgba(211, 47, 47, 0.5);
        }

        .timer-icon {
            width: 14px;
            height: 14px;
            color: var(--accent-red);
            filter: drop-shadow(0 0 3px rgba(211, 47, 47, 0.5));
        }

        .timer-section {
            position: relative;
            height: 18px;
            background: rgba(5, 5, 10, 0.9);
            border-radius: 2px;
            overflow: hidden;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.8);
        }

        .timer-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(-45deg,
                    rgba(20, 20, 25, 0.7),
                    rgba(20, 20, 25, 0.7) 10px,
                    rgba(15, 15, 20, 0.7) 10px,
                    rgba(15, 15, 20, 0.7) 20px);
            opacity: 0.5;
            z-index: 1;
        }

        .timer-value-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 22px;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.7);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.9), 0 0 5px rgba(211, 47, 47, 0.5);
            border: 1px solid rgba(211, 47, 47, 0.3);
            backdrop-filter: blur(4px);
        }

        .timer-value {
            font-size: 16px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
            font-family: var(--font-mono);
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.7);
        }

        .timer-blink {
            color: var(--accent-red);
            animation: blink 1s infinite;
            display: inline-block;
            transform: translateY(-1px);
            margin: 0 1px;
            text-shadow: 0 0 5px rgba(211, 47, 47, 0.8);
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        .timer-markers {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            padding: 0 2px;
        }

        .timer-marker {
            width: 1px;
            height: 7px;
            background: rgba(255, 255, 255, 0.15);
            position: relative;
            box-shadow: 0 0 3px rgba(255, 255, 255, 0.1);
        }

        .timer-marker:nth-child(5n) {
            height: 12px;
            width: 1.5px;
            background: rgba(255, 255, 255, 0.25);
        }

        .timer-bar {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 70%;
            background: linear-gradient(-90deg,
                    rgba(211, 47, 47, 0.8) 0%,
                    rgba(255, 71, 71, 0.95) 50%,
                    rgba(255, 100, 100, 0.9) 100%);
            z-index: 3;
            box-shadow: 0 0 20px rgba(211, 47, 47, 0.5),
                inset 0 0 15px rgba(255, 255, 255, 0.3);
        }

        .timer-noise {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 8;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' fill='white'/%3E%3C/svg%3E");
            animation: noise 0.5s infinite;
            pointer-events: none;
        }

        @keyframes noise {

            0%,
            100% {
                opacity: 0.03;
            }

            50% {
                opacity: 0.02;
            }
        }

        .remaining-indicator {
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .red-dot {
            display: inline-block;
            width: 4px;
            height: 4px;
            background: var(--accent-red);
            border-radius: 50%;
            margin-right: 2px;
            box-shadow: 0 0 3px var(--accent-red);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.5);
                opacity: 0.6;
            }
        }
    </style>
</head>

<body>
    <!-- Контейнер для сообщения загрузки -->
    <div class="loading-container">
        <div class="loader"></div>
        <p>Загрузка расследования...</p>
    </div>

    <div class="background-gradient"></div>
    <div class="app-container" style="display: none;">
        <div class="crime-scene-pattern"></div>

        <!-- Игровой экран -->
        <div class="screen active" id="game-screen">
            <header class="game-header">
                <div class="case-badge">
                    <svg class="case-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M20 6h-4V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zM10 4h4v2h-4V4zm10 16H4V8h16v12z" />
                    </svg>
                    <span class="case-number">ДЕЛО <span id="question-progress">1/5</span></span>
                </div>

                <div class="score-badge">
                    <svg class="score-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 15V3m0 12l-4 4m4-4l4 4M3 12h18" />
                    </svg>
                    <span class="score-value"><span id="score-display">0</span> ОЧКОВ</span>
                </div>

                <button class="profile-link">
                    <svg class="profile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                </button>
            </header>

            <div class="timer-container">
                <div class="timer-label">
                    <svg class="timer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 6v6l4 2" />
                    </svg>
                    ВРЕМЯ НА РАЗГАДКУ
                </div>
                <div class="timer-outer">
                    <div class="timer-section">
                        <div class="timer-background"></div>
                        <div class="timer-noise"></div>
                        <div class="timer-markers">
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                            <div class="timer-marker"></div>
                        </div>
                        <div class="timer-bar" id="timer-bar"></div>
                        <div class="timer-value-container">
                            <div class="timer-value"><span id="timer-value">15</span><span
                                    class="timer-blink">:</span>00</div>
                        </div>
                    </div>
                </div>
                <div class="remaining-indicator">
                    <span class="red-dot"></span>
                    ВРЕМЯ ИДЕТ
                </div>
            </div>

            <section class="case-file glass-effect">
                <div class="evidence-tag">УЛИКА #<span id="story-evidence-id">01</span></div>
                <h2 class="case-title" id="story-title">ОГРАБЛЕНИЕ ЮВЕЛИРНОГО МАГАЗИНА</h2>

                <div class="case-metadata">
                    <div class="metadata-item">
                        <svg class="metadata-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                            <line x1="16" y1="2" x2="16" y2="6" />
                            <line x1="8" y1="2" x2="8" y2="6" />
                            <line x1="3" y1="10" x2="21" y2="10" />
                        </svg>
                        <span id="story-date">12.04.2024</span>
                    </div>
                    <div class="metadata-item">
                        <svg class="metadata-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                        </svg>
                        <span id="story-difficulty">СЛОЖНОСТЬ: СРЕДНЯЯ</span>
                    </div>
                </div>

                <div class="case-content" id="story-content">
                    <!-- Контент истории будет добавлен динамически -->
                </div>

                <div class="mission-container">
                    <div class="mission-line"></div>
                    <div class="mission-question">Какую роковую ошибку допустил преступник?</div>
                </div>
            </section>

            <section class="answers-section">
                <div class="answers-label">
                    <svg class="answers-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                    </svg>
                    ВАРИАНТЫ ОТВЕТОВ
                </div>

                <div id="answers-container">
                    <!-- Варианты ответов будут добавлены динамически через JavaScript -->
                </div>
            </section>

            <footer class="game-footer">
                <button class="action-button" id="action-button">СЛЕДУЮЩЕЕ ДЕЛО</button>
            </footer>
        </div>

        <!-- Экран результата ответа -->
        <div class="screen" id="result-screen">
            <section class="results-section" id="result-section">
                <div class="result-badge" id="result-badge">ВЕРНО</div>

                <h3 class="result-header" id="result-header">Правильно!</h3>
                <div class="result-explanation" id="result-explanation">
                    <!-- Объяснение результата будет добавлено через JavaScript -->
                </div>
                <div class="result-points" id="result-points"><span class="points-value">120</span> ОЧКОВ</div>

                <footer class="game-footer">
                    <button class="action-button" data-action="nextQuestion">СЛЕДУЮЩЕЕ ДЕЛО</button>
                </footer>
            </section>
        </div>

        <!-- Экран результатов игры -->
        <div class="screen" id="finish-screen">
            <div class="case-file glass-effect">
                <h2 class="case-title">Расследование завершено</h2>

                <div class="case-metadata">
                    <div class="metadata-item">
                        <svg class="metadata-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                            <polyline points="22 4 12 14.01 9 11.01" />
                        </svg>
                        ИТОГИ
                    </div>
                </div>

                <div class="case-content">
                    <div class="results-details">
                        <p>Итоговый счет: <span id="final-score" class="highlighted-text">0</span></p>
                        <p>Раскрыто дел: <span id="correct-answers" class="highlighted-text">0/0</span></p>
                        <p>Эффективность: <span id="accuracy" class="highlighted-text">0%</span></p>
                    </div>

                    <div class="results-stats">
                        <h3>Досье детектива</h3>
                        <p>Всего расследований: <span id="total-games" class="highlighted-text">0</span></p>
                        <p>Общий рейтинг: <span id="total-score" class="highlighted-text">0</span></p>
                        <p>Серия успешных дел: <span id="max-streak" class="highlighted-text">0</span></p>
                    </div>
                </div>

                <footer class="game-footer">
                    <button class="action-button" data-action="restartGame">НОВОЕ РАССЛЕДОВАНИЕ</button>
                    <div style="height: 12px;"></div>
                    <button class="action-button" style="background: var(--card-bg); color: var(--accent-yellow);"
                        data-action="goToMain">В ШТАБ-КВАРТИРУ</button>
                </footer>
            </div>
        </div>
    </div>

    <!-- Подключение JavaScript файлов -->
    <script src="game-state.js"></script>
    <script src="app.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Инициализация Telegram WebApp
            if (window.Telegram?.WebApp) {
                // Расширяем WebApp
                window.Telegram.WebApp.expand();

                // Показываем кнопку "Назад" при запуске игры
                window.Telegram.WebApp.BackButton.show();

                // Настраиваем обработчик кнопки "Назад"
                window.Telegram.WebApp.BackButton.onClick(function () {
                    if (confirm('Вы уверены, что хотите прервать игру?')) {
                        window.location.href = '/';
                    }
                });
            }

            // Автоматически запускаем игру
            if (typeof startGame === 'function') {
                // Даем немного времени для загрузки
                setTimeout(function () {
                    startGame();
                }, 500);
            }
        });
    </script>
</body>

</html>