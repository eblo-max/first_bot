# Тесты для Криминальный Блеф

## Обзор

Этот каталог содержит тесты для приложения "Криминальный Блеф", адаптированные для работы с Vanilla JavaScript.

## Структура тестов

```
tests/
  ├── e2e/            # End-to-end тесты (интеграционные)
  │   └── app.test.js # Основные E2E тесты приложения
  ├── unit/           # Модульные тесты
  │   └── tma-auth.test.js # Тесты для аутентификации Telegram Mini App
  ├── utils/          # Вспомогательные утилиты для тестов
  │   └── tma-auth.js # Утилиты для тестирования аутентификации
  └── index.js        # Точка входа для запуска тестов
```

## Запуск тестов

```bash
# Запуск всех тестов
npm run test

# Запуск только E2E тестов
npm run test:e2e

# Запуск только unit тестов
npm run test:unit
```

## Особенности тестирования

### E2E тесты

End-to-end тесты используют библиотеку Playwright для автоматизации браузера и проверки интерфейса приложения. Эти тесты проверяют:

1. Базовую загрузку приложения
2. Запуск игры и отображение первого вопроса
3. Полный игровой цикл с выбором ответов и просмотром результатов

### Unit тесты

Модульные тесты проверяют отдельные компоненты приложения и не требуют браузера. В настоящее время есть тесты для:

1. Генерации и валидации Telegram initData
2. Создания тестовой заглушки Telegram WebApp для тестирования

### Утилиты для тестирования

В директории `utils` находятся вспомогательные функции для тестирования, включая:

1. Функции для генерации тестовых данных Telegram Mini App
2. Функции для валидации данных Telegram Mini App
3. Заглушки для объекта Telegram.WebApp

## Режимы тестирования

### Тестовый режим

Для запуска приложения в тестовом режиме без Telegram WebApp API:
```
http://localhost:3000?test=true
```

### Автозапуск игры

Для автоматического запуска игры (полезно для тестирования):
```
http://localhost:3000?autostart=true
```

### Комбинированный режим

Для тестирования с автозапуском игры:
```
http://localhost:3000?test=true&autostart=true
```

## Тестовый интерфейс

Для ручного тестирования в консоли браузера можно использовать глобальный тестовый интерфейс:

```javascript
// Запуск игры
window.CriminalBluffTestInterface.startGame();

// Выбор ответа по индексу (0, 1, 2, ...)
window.CriminalBluffTestInterface.selectAnswerByIndex(0);

// Переход к следующему вопросу
window.CriminalBluffTestInterface.nextQuestion();

// Перезапуск игры
window.CriminalBluffTestInterface.restartGame();

// Возврат на главную
window.CriminalBluffTestInterface.goToMain();

// Загрузка тестовых историй
window.CriminalBluffTestInterface.loadTestStories();
``` 